<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><meta name="description" content="不只是技术">
<meta property="og:type" content="website">
<meta property="og:title" content="罗啰明天">
<meta property="og:url" content="https://luomingbear.github.io/page/8/index.html">
<meta property="og:site_name" content="罗啰明天">
<meta property="og:description" content="不只是技术">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Bearever">
<meta property="article:tag" content="Android">
<meta name="twitter:card" content="summary"><title>罗啰明天</title><link ref="canonical" href="https://luomingbear.github.io/page/8/index.html"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"Copy","copySuccess":"Copy Success","copyError":"Copy Error"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">Home</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">Archives</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">罗啰明天</div><div class="header-banner-info__subtitle"></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content content-home" id="content"><section class="postlist"><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/07/22/sc2020-07-21%20a10.56.54/">sc2020-07-21 a10.56.54</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-07-22</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2021-03-18</span></span></div></header><div class="post-body"><div class="post-excerpt"></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/07/22/sc2020-07-20%20b7.51.41/">sc2020-07-20 b7.51.41</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-07-22</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2021-03-18</span></span></div></header><div class="post-body"><div class="post-excerpt"></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/07/22/p53763/">p53763</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-07-22</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2021-03-18</span></span></div></header><div class="post-body"><div class="post-excerpt"></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/07/22/WX20200721-121201@2x/">WX20200721-121201@2x</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-07-22</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2021-03-18</span></span></div></header><div class="post-body"><div class="post-excerpt"></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/07/22/%E5%87%BD%E6%95%B0%E8%AE%A1%E7%AE%97%E6%9E%B6%E6%9E%84/">函数计算架构</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-07-22</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2021-03-18</span></span></div></header><div class="post-body"><div class="post-excerpt"></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/07/21/%E4%BD%BF%E7%94%A8%E9%98%BF%E9%87%8C%E4%BA%91%E5%87%BD%E6%95%B0%E8%AE%A1%E7%AE%97%E6%90%AD%E5%BB%BAWordpress%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F/">使用阿里云函数计算搭建Wordpress博客系统</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-07-21</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2021-03-18</span></span></div></header><div class="post-body"><div class="post-excerpt"><p><img src="http://file.2fun.xyz/2020/07/screen-themes.png" alt="" /></p>
<h2>起因</h2>
<p>这篇文章是对周末折腾的一个记录，一切都源于阿里云客服说我的服务器马上到期了。之前购买的阿里云的ECS，三年下来需要两千多块钱，但是平时用的多的就一个博客系统和账单接口在跑，CPU使用率仅有4%。然后无意间看到阿里的语雀团队使用函数计算大大的减少了服务器的维护成本，也避免了CPU使用率一直很低的情况。受此启发决定将我的博客转移到阿里云函数计算上面，幸运的是官方也给了wordpress搭建教程（仅仅是能用）。
附上官方的函数计算与传统ECS价格对比：</p>
<div class="table-container"><table>
<thead>
<tr>
<th>ITEM</th>
<th>成本</th>
<th>稳定性</th>
</tr>
</thead>
<tbody>
<tr>
<td>基于 VM 方案</td>
<td>使用 ecs.t5-lc1m1.small, 22.8元/月</td>
<td>服务器和数据库在同一台VM, 均无主备容灾，同时该规格的主机本身性能弱</td>
</tr>
<tr>
<td>轻量应用服务器</td>
<td>60元/月(1vCPU 1GB 1Mbps 20GB[ssd])</td>
<td>服务器和数据库在同一台VM, 均无主备容灾，同时该规格的主机本身性能弱</td>
</tr>
<tr>
<td>函数计算</td>
<td>sqlite3 版本约为 1元/月 mysql 版本大约 26元/月</td>
<td>高</td>
</tr>
</tbody>
</table></div>
<h2>概要</h2>
<p>本文将对搭建的过程和函数计算+Wordpress的架构做一个简单的描述，如有不对请以<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/146729.html?source=5176.11533457&amp;userCode=bdcxtb8v&amp;type=copy" >官方文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>为准。整个文章的目录如图1所示，分为函数计算架构设计、准备工作、搭建Wordpress、配置Wordpress和支持Https五大部分。</p>
<p><img src="http://file.2fun.xyz/2020/07/函数计算Wordpress目录.png" alt="图1. 文章目录结构" />
<em>图1. 文章目录结构</em></p>
<h2>函数计算+Wordpress的架构设计</h2>
<p>在使用函数计算之前，我们先了解一下函数计算是什么，这样有助于理解每一步在干嘛。下面是阿里云官网的介绍：</p>
<blockquote>
<p>函数计算（Function Compute）是一个事件驱动的全托管 Serverless 计算服务。您无需管理服务器等基础设施，只需编写代码并上传。函数计算会为您准备好计算资源，并以弹性、可靠的方式运行您的代码。</p>
</blockquote>
<p>可以把函数计算理解成一个运行在容器里面的代码片段，我们只需要上传自己的代码片段，函数计算服务会自动帮我们处理运行环境和伸缩配置。但是函数计算只是用来运行一段代码的，它本身是没有上下文记录的功能的，所以官方的做法是搭配使用了阿里云的NAS服务（阿里云文件存储服务）。NAS相当于一台远程的移动硬盘，函数计算引擎可以与这块硬盘进行绑定，以实现文件操作。通过上面的介绍我们就可以看看基于函数计算的Wordpress是怎么架构的。</p>
<p><img src="http://file.2fun.xyz/2020/07/aa24a63302dfac74a54fbada4b273361bf5d179b.png" alt="图2.函数计算Wordpress架构" />
<em>图2. 函数计算Wordpress架构</em></p>
<p>如图2所示，客户端的请求会发送到函数计算服务器的PHP运行环境，该环境与NAS进行了绑定，所以我们的请求可以直接操作NAS里面的Wordpress文件。这里如果需要用到数据库的话，就会连接RDS（云数据库服务）进行数据的增删改查。由于所有的函数执行的时候都是对同一个NAS和RDS进行的操作，最后的效果就像是在同一台服务器上面进行的操作一样。
<strong>重点：Wordpress的源文件是存放在NAS上面的，函数计算仅仅是提供了一个入口，数据库在RDS上面，通过远程连接的方式进行访问。</strong></p>
<h2>流程</h2>
<p>创建Wordpress博客系统一共需要4个步骤，如图3所示，分别是准备阶段、创建Wordpress、配置Wordpress和支持Https，如果不想支持Https的话，那第四步可以省略。</p>
<p><img src="http://file.2fun.xyz/2020/07/函数计算wordpress流程2.png" alt="图3. 创建wordpress的流程" />
<em>图3. 创建wordpress的流程</em></p>
<h2>准备阶段</h2>
<h3>购买域名</h3>
<p>一个完整的个人博客需要有一个独立的域名，所以在开发之前需要申请一个个人域名，可以直接在<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://wanwang.aliyun.com/domain?source=5176.11533457&amp;userCode=bdcxtb8v&amp;type=copy" >万网官网</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>进行申请，输入想要的域名下单购买就好。</p>
<p><img src="http://file.2fun.xyz/2020/07/截屏2020-07-20-下午7.51.41-1024x436.png" alt="图4. 万网购买域名" />
<em>图4. 万网购买域名</em></p>
<h3>域名备案</h3>
<p>购买域名之后就需要进行备案了，如果是在万网上面购买的域名，则可以直接使用阿里云的<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.aliyun.com/activity/beian/gift?source=5176.11533457&amp;userCode=bdcxtb8v&amp;type=copy" >备案服务</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>进行备案。在发起备案申请之后需要等待阿里云寄送一张幕布过来，收到幕布之后站在幕布前面手持生份证进行拍照提交审核就可以了，整个过程可能需要两周。</p>
<h3>开通函数计算服务</h3>
<p>在阿里云<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.aliyun.com/product/fc?source=5176.11533457&amp;userCode=bdcxtb8v&amp;type=copy" >开通函数计算服务</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，选择<a target="_blank" rel="noopener" href="https://www.aliyun.com/product/fc?source=5176.11533457&amp;userCode=bdcxtb8v&amp;type=copy"><strong>免费开通</strong></a>，这样就是按量付费，函数计算每月有100万次免费额度，基本上够我们使用了。
<img src="http://file.2fun.xyz/2020/07/截屏2020-07-21-上午10.56.54.png" alt="图5. 免费开通函数计算" />
<em>图5. 免费开通函数计算</em></p>
<h3>开通NAS服务</h3>
<p>在阿里云<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.aliyun.com/product/nas?source=5176.11533457&amp;userCode=bdcxtb8v&amp;type=copy" >开通使用文件存储NAS服务</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>即可。
<img src="http://file.2fun.xyz/2020/07/截屏2020-07-21-上午11.01.51.png" alt="" />
<em>图6. 开通NAS服务</em></p>
<h3>开通RDS服务</h3>
<p>另外我们还需要为博客创建RDS数据库，进入阿里云，开通<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.aliyun.com/product/rds/mysql?source=5176.11533457&amp;userCode=bdcxtb8v&amp;type=copy" >RDS-MySQL版</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，我购买的时候有新客优惠，一年仅需54元，如果没有优惠的话推荐购买3年及以上，这样更划算。
<img src="http://file.2fun.xyz/2020/07/截屏2020-07-21-上午11.15.04.png" alt="图7. RDS MySQL服务" />
<em>图7. RDS MySQL服务</em></p>
<h2>创建Wordpress</h2>
<p>准备工作完成之后我们就可以开发创建Wordpress了，首先需要下载函数计算的工具fun，并clone fc-wordpress代码到本地。</p>
<h3>下载fun工具</h3>
<p>fun工具提供了多种方式安装，详细信息请查看<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/alibaba/funcraft/blob/master/docs/usage/installation-zh.md?spm=a2c6h.12873639.0.0.7b8427b4YkbbwW&amp;file=installation-zh.md" >官方文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>。</p>
<h3>git clone fc-wordpress</h3>
<p>将fc-wordpress到源码下载到本地。</p>
<pre><code>git clone https://github.com/awesome-fc/fc-wordpress.git</code></pre>
<h3>将Wordpress上传到NAS</h3>
<p><strong>初始化NAS</strong>
这里我使用的是MySQL数据库，所以首先cd进入<code>fc-wp-mysql</code>文件夹(<strong>强烈建议打开显示隐藏文件的功能，这样更容易理解步骤</strong>)，执行以下命令：</p>
<pre><code>fun nas init
fun nas info</code></pre>
<blockquote>
<p><code>fun nas init</code>: 初始化 NAS, 基于您的 .env 中的信息获取(已有满足条件的nas)或创建一个同region可用的nas
如果你没有修改 templata.yml 中的配置 service名字， 那么则可以进入下一步； 如果有修改， 会在当前目录生成新的目录 .fun/nas/auto-default/{serviceName} (<code>fun nas info</code> 可以列出新的目录), 将默认目录下的 .fun/nas/auto-default/fc-wp-mysql/wordpress 的wordpress目录拷贝到 .fun/nas/auto-default/{serviceName} 下， 同时可以删除目录 .fun/nas/auto-default/fc-wp-mysql/wordpress</p>
</blockquote>
<p><strong>上传到NAS</strong>
执行如下命令将本地的Wordpress文件上传到NAS：</p>
<pre><code>fun nas sync
fun nas ls nas:///mnt/auto/</code></pre>
<blockquote>
<p><code>fun nas sync</code>: 将本地 NAS 中的内容（.fun/nas/auto-default/fc-wp-mysql）上传到 NAS 中的 fc-wp-mysql 目录
<code>fun nas ls nas:///mnt/auto/</code>: 查看我们是否已经正确将文件上传到了NAS</p>
</blockquote>
<h3>配置域名信息</h3>
<p>修改<code> index.php</code> 中的<code>$host</code>中的值，<code> $host</code> 修改为自己的域名， 修改 <code>template.yml </code>中 <code>DomainName: Auto </code>, Auto 修改成自己的域名。
修改 <code>template.yml </code>LogConfig 中的 Project, 任意取一个不会重复的名字即可, 有两处地方需要更改，如图8所示。</p>
<p><img src="http://file.2fun.xyz/2020/07/0cbbe03eebd58f5e6696e3214c9750083f8013ea-300x171.png" alt="图8. 修改template.yml" />
<em>图8. 修改template.yml</em></p>
<h3>发布函数</h3>
<p>执行<code>fun deploy</code>，完成最终的部署。
登录控制台 <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://fc.console.aliyun.com" >https://fc.console.aliyun.com</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> ，可以看到service 和 函数已经创建成功， 并且 service 也已经正确配置。</p>
<ol start="3">
<li>通过浏览器自己的域名，即可看到Wordpress页面。</li>
</ol>
<h2>配置Wordpress</h2>
<p>完成Wordpress安装之后我们就可以进行博客具体配置了，首次打开会提示选择一个语言，在底部有一个“简体中文”。选择语言之后就进入正式配置阶段，如图9所示。</p>
<p><img src="http://file.2fun.xyz/2020/07/generate-wp-config-file.png" alt="图9. Wordpress初始页面" />
<em>图9. Wordpress初始页面</em></p>
<h3>创建RDS数据库</h3>
<p>如图9所示，我们需要提供一个数据库，这时可以去RDS <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://rdsnext.console.aliyun.com/" >MYSQL控制台</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>创建一个数据库。</p>
<p><strong>创建数据库账户</strong>
首先我们创建一个普通账号，用来管理博客的数据库。
<img src="http://file.2fun.xyz/2020/07/WX20200721-121201@2x.png" alt="图10. 创建普通账户" />
<em>图10. 创建普通账户</em></p>
<p><strong>创建数据库</strong>
然后创建一个数据库，并将权限授予刚才的账户。
<img src="http://file.2fun.xyz/2020/07/WX20200721-121525@2x.png" alt="图11. 创建数据库" />
<em>图11. 创建数据库</em></p>
<p><strong>设置白名单</strong>
这时我们的数据库还不能背外面访问，需要先设置白名单，为了简单，我这里是直接添加的允许<code>0.0.0.0/0</code>访问，如果想要更加精细的权限控制，可以查看<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/100272.html?source=5176.11533457&amp;userCode=bdcxtb8v&amp;type=copy" >官方文档</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>。</p>
<p><img src="http://file.2fun.xyz/2020/07/WX20200721-122239@2x.png" alt="图12. 设置白名单" />
<em>图12. 设置白名单</em></p>
<p><strong>获取外网地址</strong>
设置白名单之后就可以申请外网地址了。
<img src="http://file.2fun.xyz/2020/07/WX20200721-130217@2x.png" alt="图13. 获取RDS外网地址" />
<em>图13. 获取RDS外网地址</em></p>
<h3>Wordpress绑定数据库</h3>
<p>数据库创建成功之后就可以配置Wordpress的数据库信息了，需要注意的地方是<strong>数据库主机要填写RDS的外网地址，而不是locallhost</strong></p>
<p><img src="http://file.2fun.xyz/2020/07/WX20200721-130652@2x.png" alt="图14. Wordpress绑定数据库" />
<em>图14. Wordpress绑定数据库</em></p>
<h3>创建账户和网站信息</h3>
<p>配置好数据库之后就可以进入网站信息配置页面了，如图15所示，需要填写网站标题、用户名、密码和邮箱等信息。</p>
<p><img src="http://file.2fun.xyz/2020/07/WX20200721-131400@2x-1024x666.png" alt="图15. 创建账户和网站信息" />
<em>图15. 创建账户和网站信息</em></p>
<h3>网站个性化（可选）</h3>
<p>经过上面的步骤，我们的网站就配置完成了，但是这时的网站还十分简陋，外观也不能达到我们的需求，所以我们需要对它换个皮。我尝试在Wordpress的后台直接安装主题，但是每一次都是安装失败，最后我找到了一种安装主题的方式：直接把主题文件上传到NAS里面。</p>
<p><strong>下载主题</strong>
首先去<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://wordpress.org/themes" >https://wordpress.org/themes </a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>下载喜欢的主题，然后将主题的文件夹拷贝到本地<code>fc-wordpress地址//Users/bear/PhpstormProjects/fc-wordpress/fc-web-mysql/.fun/nas/auto-default/fc-wp-mysql/wordpress/wp-content/themes</code>文件夹下面，如图16所示，writers文件夹就是我下载的主题。
<img src="http://file.2fun.xyz/2020/07/WX20200721-132211@2x-1024x469.png" alt="下载主题" />
<em>图16. 下载主题</em></p>
<p><strong>同步NAS</strong>
将主题复制到wordpress的主题文件夹之后，我们需要把本地的wordpress信息与NAS进行同步，执行<code>fun nas sync</code>即可将本地文件上传到NAS上面。这时在我们的Wordpress后台就可以看到新安装的主题了。</p>
<h2>支持Https（可选）</h2>
<h3>下载Https证书</h3>
<h3>更新函数计算域名信息</h3>
<h3>安装really-simple-ssl插件</h3>
<h2>Enjoy</h2></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/07/20/AndroidStudio%20build%20failed/">AndroidStudio build failed</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-07-20</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2021-03-18</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>使用安卓AndroidStudio开发应用的时候，经常会出现编译失败的情况，有的时候，AS会告诉我们是哪里出了问题，但是有的时候只会提示一段类似这样的话：</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-null">org.gradle.api.tasks.TaskExecutionException: Execution failed for task ':chat_lib:compileDebugKotlin'.
    at org.gradle.api.internal.tasks.execution.ExecuteActionsTaskExecuter.executeActions(ExecuteActionsTaskExecuter.java:100)
    at org.gradle.api.internal.tasks.execution.ExecuteActionsTaskExecuter.execute(ExecuteActionsTaskExecuter.java:70)
    at org.gradle.api.internal.tasks.execution.OutputDirectoryCreatingTaskExecuter.execute(OutputDirectoryCreatingTaskExecuter.java:51)
    at org.gradle.api.internal.tasks.execution.SkipUpToDateTaskExecuter.execute(SkipUpToDateTaskExecuter.java:62)
    at org.gradle.api.internal.tasks.execution.ResolveTaskOutputCachingStateExecuter.execute(ResolveTaskOutputCachingStateExecuter.java:54)
    at org.gradle.api.internal.tasks.execution.ValidatingTaskExecuter.execute(ValidatingTaskExecuter.java:60)
    at org.gradle.api.internal.tasks.execution.SkipEmptySourceFilesTaskExecuter.execute(SkipEmptySourceFilesTaskExecuter.java:97)
    ...
</code></pre>
<p>对于这样的描述，我们也只是一头雾水，有没有可能知道更加清除的错误信息呢？答案是有的，而且就在上面的输出日志里面。上面错误信息的第一句话写的是<code>org.gradle.api.tasks.TaskExecutionException: Execution failed for task ':chat_lib:compileDebugKotlin'.</code>,这里已经告诉我们是因为什么出了问题，原来就是执行<code>chat_lib:compileDebugKotlin</code>的时候报错了。我们打开AS的终端，输入:</p>
<pre class="line-numbers prism-highlight" data-start="1"><code class="language-shell">gradlew chat_lib:compileDebugKotlin
</code></pre>
<p>运行这个TASK,就可以看到详情的错误原因了。</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/07/20/Android%20Studio%20Profiler%20%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E5%88%86%E6%9E%90/">Android Studio Profiler 内存泄漏分析</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-07-20</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2021-03-18</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>最近的项目中出现了内存泄漏，在踩了好多坑之后，终于解决了遇到的泄漏问题，为了防止下次忘记，所以把这次的经验记录下来。</p>
<h3>前言</h3>
内存泄漏有很多种的情况，在安卓里面，大多是因为内部类持有了<code>Activity</code>或者<code>Context</code>的引用导致<code>Activity</code>或者<code>Context</code>无法释放，最常见的是执行了一个耗时操作，在退出<code>Activity</code>的时候没有关闭耗时操作，导致<code>Activity</code>一直被耗时操作持有。
例如网上经常会有讲到使用<code>Handler</code>的时候需要注意泄漏，需要使用静态内部类，并且弱引用<code>Activity</code>解决。这样的地方可以在写代码的时候注意到然后解决，但是有些时候我们也不知道哪里出现了内存泄漏，就需要通过工具帮助我们分析了。
<h3>Android Studio Profiler</h3>
Android Studio自带的Profiler就提供了这样的能力，打开Profiler会看到如下的界面，
<img src="https://file.2fun.xyz/android_studio_profiler20190704174351.png" alt="">
然后点击红色选框中的部分，就可以进入内存分析详情如下：
<img src="https://file.2fun.xyz/android_studio_profiler20190704174635.png" alt="">
为了查看到内存泄漏，我们需要对app进行一顿操作。如果我们想知道一个<code>TestActivity</code>有没有内存泄漏，那么我们可以频繁的进出<code>TestActivity</code>,按照官网的说法横竖屏切换和回退到桌面再进入app也会增加泄漏的风险。一顿操作猛如虎，要知泄漏有没有，且看下面。
当我们频繁操作之后，可以先点击左上角的垃圾桶按钮，进行强制GC，多点几次，接下来点击左上角的下箭头图标生成分析文件，这就是我们判断有没有内存泄漏的关键。
<img src="https://file.2fun.xyz/android_studio_profiler_dump2019.gif" alt="">
为了方便查看，我们可以把分组方式改为按照包名分组
<img src="https://file.2fun.xyz/android_studio_profiler20190704180503.png" alt="">
那么怎么看有没有泄漏呢？在左下角的堆窗口找到我们想要测试的那个class名，点击会出现如下的窗口：
<img src="https://file.2fun.xyz/android_studio_profiler20190704181022.png" alt="">
其中左下角的<code>HandlerActivity</code>和<code>HandlerActivity$1</code>可能第一次看会很迷，难道说我的这个类有两个实例吗,那不就是内存泄漏了么?其实并不是这个意思，<code>$</code>符号只是说明这个类有一个内部类而已，因为内部类会持有外部类的引用。
右上角的地方我们可以看到有四个<code>HandlerActivity</code>，那这个说明是内存泄漏了么？是的，这个<code>Instance View</code>就是实例窗口，有几个就说明有几个实例，如果按照逻辑这个对象同时只能有一个实例的话，那就是内存泄漏了。
当知道是内存泄漏之后就需要找到泄漏的地方，在右下角有一个引用窗口，可以看到具体是谁引用这个它，导致内存不能及时回收。在右上角的实例窗口选中一个实例，然后在引用窗口选中一条点击右键<code>Jump to Source</code>就可以看到具体引用的地方，然后观察代码就知道是什么问题导致的内存泄漏了。
<img src="https://file.2fun.xyz/android_profiler20190704181835.png" alt=""></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/07/20/%E7%99%BB%E5%BD%95/">登录</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-07-20</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2021-03-18</span></span></div></header><div class="post-body"><div class="post-excerpt"></div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2020/07/20/cropped-luo-1.png/">cropped-luo-1.png</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2020-07-20</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2021-03-18</span></span></div></header><div class="post-body"><div class="post-excerpt"><p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://file.2fun.xyz/2020/07/cropped-luo-1.png" >http://file.2fun.xyz/2020/07/cropped-luo-1.png</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</div></div></article></section><nav class="paginator"><div class="paginator-inner"><a class="extend prev" rel="prev" href="/page/7/"><i class="fas fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/9/"><i class="fas fa-angle-right"></i></a></div></nav></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><section class="sidebar-toc hide"></section><!-- ov = overview--><section class="sidebar-ov"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/icons/stun-logo.svg" alt="avatar"></div><p class="sidebar-ov-author__text">hello world</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">162</div><div class="sidebar-ov-state-item__name">Archives</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="Creative Commons" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2021</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>Bearever</span></div><div><span>Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a></span><span> v5.4.0</span><span class="footer__devider">|</span><span>Theme - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.6.2</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script></body></html>